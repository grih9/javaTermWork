<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Title</title>
    <link rel="stylesheet" href="css/app.css">
    <script language="JavaScript">
        function unAuthorize() {
            localStorage.clear();
            window.location.href = "./index.html";
        }

        function isLog() {
            if (localStorage.getItem("Authentication") !== null) {
                alert("You have already logged in");
                window.location.href = "./table.html";
            } else {
                localStorage.clear();
                window.location.href = "./login.html";
            }
        }

        function getArticles() {
            fetch("http://localhost:8080/articles/all")
                .then( (response) => {
                    if (response.status >= 400) {
                        console.log("Error occurred");
                        alert("You have no access. Log in please.");
                        localStorage.clear();
                        return Promise.reject();
                    }
                    return response.json()
                }).then(function (articlesList) {
                var htmlArticle = "";
                document.getElementById("wrapper").innerHTML = htmlArticle;

                htmlArticle += "<table id='articles' border = '1' align='center'>";
                htmlArticle += "<tr align='center'>";
                htmlArticle += "<th width='80px'>id</th>";
                htmlArticle += "<th width='190px'>name</th>";
                htmlArticle += "</tr>";

                if (articlesList.length === 0) {
                    htmlArticle += "<tr>";
                    htmlArticle += "<td></br></td>";
                    htmlArticle += "<td></br></td>";
                    htmlArticle += "</tr>";
                }

                for (var i = 0; i < articlesList.length; i++) {
                    htmlArticle += "<tr align='center'>";
                    htmlArticle += "<td>" + articlesList[i].id + "</td>";
                    htmlArticle += "<td>" + articlesList[i].name + "</td>";
                    htmlArticle += "</tr>";
                }

                htmlArticle += "</table>";

                document.getElementById("wrapper").innerHTML += htmlArticle;
            });
        }
    </script>
</head>
<body>
<main id="app">
    <header>
        <h1>Articles Table</h1>
    </header>
    <p></p>
    <div id="wrapper"> <script>
        getArticles();
    </script></div>
    <p></p>
    <form id="todo-form">
        <input value="Back" type="button" onclick="history.back();"/>
        <input value="Log in" type="button" onclick=isLog() />
        <input value="Sign up" type="button" onclick="location.href='reg.html'"/>
    </form>
</main>
</body>
</html>