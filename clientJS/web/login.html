<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Log In</title>
    <script language="JavaScript">
        function submitLogin() {
            var username = document.getElementById("userName").value;
            var pass = document.getElementById("password").value;
            if((username == '') || (pass == '')){
                alert("Enter data please");
            } else {
                fetch("http://localhost:8080/auth/signIn", {
                    method: "POST",
                    headers: {
                            'Content-Type': 'application/json'
                        },
                    body: JSON.stringify({
                      userName: username,
                      password: pass
                    })
                })
                    .then( (response) => {
                        if(response.status >= 400){
                            console.log("Check entered data please");
                            return Promise.reject();
                        }
                        return response.json();
                    }).then( (j) => JSON.stringify(j))
                    .then( (data) => JSON.parse(data))
                    .then( (obj) => localStorage.setItem("Authentication", obj["token"]))
                    .then( () => window.location.href = "./success.html" )
                    .catch( () => alert("User with this login and password is not found"));
              }
          }
    </script>
    <link rel="stylesheet" href="css/app.css">
</head>

<body id="login">
<main id="app">
    <header>
        <h1>Log in</h1>
    </header>
    <p align="center">
        <input id="userName" class="textfield" type="text" placeholder="username">
        <input id="password" class="textfield" type="password" placeholder="password">
    </p>

    <form id="todo-form">
        <input value="Back" type="button" onclick="history.back();"/>
        <input id="login_confirm" value="Confirm" type="button" onclick=submitLogin() />
    </form>
</main>
</body>
</html>
